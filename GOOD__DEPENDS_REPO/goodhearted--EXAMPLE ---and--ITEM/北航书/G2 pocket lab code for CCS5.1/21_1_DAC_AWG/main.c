/*
 * main.c
 */
#include "MSP430G2553.h"
#include "DAC8411.h"
#define SYSCLK 					12000000		//当前主时钟频率
#define AWG_FREQ 			20					//AWG信号频率
#define SAMPLENUM     	1144				//采样点数

const unsigned int Data[SAMPLENUM]={
		57892,
		57373,
		56818,
		56307,
		55788,
		55233,
		54723,
		54203,
		53648,
		53138,
		52618,
		52063,
		51509,
		50998,
		50479,
		49924,
		49413,
		48894,
		48339,
		47828,
		47309,
		46754,
		46243,
		45724,
		45169,
		44615,
		44104,
		43584,
		43030,
		42519,
		41999,
		41445,
		40934,
		40415,
		39860,
		39349,
		38794,
		38275,
		37720,
		37210,
		36690,
		36135,
		35625,
		35105,
		34550,
		34040,
		33520,
		32966,
		32455,
		31900,
		31381,
		30826,
		30315,
		29796,
		29241,
		28730,
		28211,
		27656,
		27146,
		26626,
		26071,
		25517,
		25006,
		24486,
		23932,
		23421,
		22902,
		22347,
		21836,
		21317,
		20762,
		20251,
		19732,
		19177,
		18622,
		18112,
		17592,
		17038,
		16527,
		16007,
		15453,
		14942,
		14422,
		13868,
		13357,
		12802,
		12283,
		11728,
		11217,
		10698,
		10143,
		9633,
		9113,
		8558,
		8048,
		7528,
		6973,
		6463,
		6304,
		6542,
		6780,
		7018,
		7255,
		7493,
		7731,
		7968,
		8162,
		8400,
		8638,
		8875,
		9113,
		9351,
		9589,
		9826,
		10064,
		10302,
		10539,
		10777,
		11015,
		11253,
		11490,
		11728,
		11966,
		12168,
		12406,
		12644,
		12882,
		13119,
		13357,
		13595,
		13833,
		14070,
		14308,
		14546,
		14783,
		15021,
		15259,
		15497,
		15734,
		15928,
		16166,
		16404,
		16641,
		16879,
		17117,
		17354,
		17592,
		17830,
		18068,
		18305,
		18543,
		18781,
		19019,
		19256,
		19494,
		19732,
		19934,
		20172,
		20410,
		20648,
		20885,
		21123,
		21361,
		21598,
		21836,
		22074,
		22312,
		22549,
		22787,
		23025,
		23263,
		23500,
		23694,
		23932,
		24169,
		24407,
		24645,
		24883,
		25120,
		25358,
		25596,
		25834,
		26071,
		26309,
		26547,
		26785,
		27022,
		27260,
		27498,
		27700,
		27938,
		28176,
		28413,
		28651,
		28889,
		29127,
		29364,
		29602,
		29840,
		30078,
		30315,
		30553,
		30791,
		31029,
		31266,
		31460,
		31698,
		31935,
		32173,
		32411,
		32649,
		32886,
		33124,
		33362,
		33600,
		33837,
		34075,
		34313,
		34550,
		34788,
		35026,
		35264,
		35466,
		35704,
		35942,
		36179,
		36417,
		36655,
		36893,
		37130,
		37324,
		37086,
		36849,
		36611,
		36373,
		36135,
		35898,
		35660,
		35422,
		35228,
		34991,
		34753,
		34515,
		34278,
		34040,
		33802,
		33564,
		33327,
		33089,
		32851,
		32613,
		32376,
		32138,
		31900,
		31662,
		31460,
		31222,
		30985,
		30747,
		30509,
		30271,
		30034,
		29796,
		29558,
		29320,
		29083,
		28845,
		28607,
		28369,
		28132,
		27894,
		27656,
		27463,
		27225,
		26987,
		26749,
		26512,
		26274,
		26036,
		25798,
		25561,
		25323,
		25085,
		24847,
		24610,
		24372,
		24134,
		23897,
		23694,
		23456,
		23219,
		22981,
		22743,
		22505,
		22268,
		22030,
		21792,
		21554,
		21317,
		21079,
		20841,
		20604,
		20366,
		20128,
		19890,
		19697,
		19459,
		19221,
		18983,
		18746,
		18508,
		18270,
		18032,
		17795,
		17557,
		17319,
		17082,
		16844,
		16606,
		16368,
		16131,
		15928,
		15690,
		15453,
		15215,
		14977,
		14739,
		14502,
		14264,
		14026,
		13789,
		13551,
		13313,
		13075,
		12838,
		12600,
		12362,
		12124,
		11931,
		11693,
		11455,
		11217,
		10980,
		10742,
		10504,
		10267,
		10029,
		9791,
		9553,
		9316,
		9078,
		8840,
		8602,
		8365,
		8162,
		7924,
		7687,
		7449,
		7211,
		6973,
		6736,
		6498,
		6304,
		6815,
		7334,
		7845,
		8400,
		8919,
		9430,
		9985,
		10504,
		11015,
		11570,
		12089,
		12600,
		13155,
		13709,
		14229,
		14739,
		15294,
		15814,
		16324,
		16879,
		17399,
		17909,
		18464,
		18983,
		19538,
		20049,
		20604,
		21123,
		21634,
		22188,
		22708,
		23219,
		23773,
		24293,
		24803,
		25358,
		25878,
		26432,
		26943,
		27498,
		28017,
		28528,
		29083,
		29602,
		30113,
		30668,
		31187,
		31698,
		32252,
		32807,
		33327,
		33837,
		34392,
		34911,
		35422,
		35977,
		36496,
		37007,
		37562,
		38081,
		38592,
		39147,
		39701,
		40221,
		40732,
		41286,
		41806,
		42316,
		42871,
		43391,
		43901,
		44456,
		44976,
		45530,
		46041,
		46596,
		47115,
		47626,
		48181,
		48700,
		49211,
		49765,
		50285,
		50796,
		51350,
		51870,
		52424,
		52935,
		53490,
		54009,
		54520,
		55075,
		55594,
		56105,
		56660,
		57179,
		57690,
		58209,
		38433,
		38116,
		37685,
		37245,
		36849,
		36373,
		35977,
		35545,
		35105,
		34709,
		34234,
		33837,
		33406,
		32966,
		32569,
		32094,
		31698,
		31266,
		30826,
		30430,
		29954,
		29558,
		29127,
		28686,
		28290,
		27815,
		27419,
		26987,
		26547,
		26151,
		25675,
		25279,
		24847,
		24407,
		24011,
		23536,
		23139,
		22708,
		22268,
		21871,
		21396,
		21000,
		20568,
		20128,
		19732,
		19256,
		18860,
		18429,
		17988,
		17592,
		17117,
		16721,
		16289,
		15849,
		15453,
		14977,
		14581,
		14150,
		13709,
		13313,
		12838,
		12441,
		12010,
		11570,
		11173,
		10698,
		10302,
		9870,
		9430,
		9034,
		8558,
		8162,
		7731,
		7290,
		6894,
		6463,
		6859,
		7290,
		7687,
		8127,
		8558,
		8999,
		9430,
		9826,
		10267,
		10698,
		11138,
		11570,
		11966,
		12406,
		12838,
		13278,
		13709,
		14105,
		14546,
		14977,
		15417,
		15849,
		16245,
		16685,
		17117,
		17557,
		17988,
		18385,
		18825,
		19256,
		19697,
		20128,
		20524,
		20965,
		21396,
		21836,
		22268,
		22664,
		23104,
		23536,
		23976,
		24407,
		24803,
		25244,
		25675,
		26115,
		26547,
		26943,
		27383,
		27815,
		28255,
		28686,
		29083,
		29523,
		29954,
		30395,
		30826,
		31222,
		31662,
		32094,
		32534,
		32966,
		33362,
		33802,
		34234,
		34674,
		35105,
		35501,
		35942,
		36373,
		36813,
		37245,
		37641,
		38081,
		5195,
		5706,
		6225,
		6736,
		7290,
		7810,
		8321,
		8875,
		9395,
		9906,
		10460,
		10980,
		11534,
		12045,
		12600,
		13119,
		13630,
		14185,
		14704,
		15215,
		15770,
		16289,
		16800,
		17354,
		17874,
		18429,
		18939,
		19494,
		20014,
		20524,
		21079,
		21598,
		22109,
		22664,
		23183,
		23694,
		24249,
		24803,
		25323,
		25834,
		26388,
		26908,
		27419,
		27973,
		28493,
		29003,
		29558,
		30078,
		30588,
		31143,
		31698,
		32217,
		32728,
		33283,
		33802,
		34313,
		34867,
		35387,
		35898,
		36452,
		36972,
		37527,
		38037,
		38592,
		39111,
		39622,
		40177,
		40696,
		41207,
		41762,
		42281,
		42792,
		43347,
		43866,
		44421,
		44931,
		45486,
		46006,
		46516,
		47071,
		47591,
		48101,
		48656,
		49175,
		49686,
		50241,
		50796,
		51315,
		51826,
		52380,
		52900,
		53411,
		53965,
		54485,
		54996,
		55550,
		56070,
		56580,
		57100,
		56897,
		56660,
		56422,
		56184,
		55946,
		55709,
		55471,
		55233,
		55040,
		54802,
		54564,
		54326,
		54089,
		53851,
		53613,
		53375,
		53138,
		52900,
		52662,
		52424,
		52187,
		51949,
		51711,
		51474,
		51271,
		51033,
		50796,
		50558,
		50320,
		50082,
		49845,
		49607,
		49369,
		49131,
		48894,
		48656,
		48418,
		48181,
		47943,
		47705,
		47467,
		47274,
		47036,
		46798,
		46560,
		46323,
		46085,
		45847,
		45609,
		45372,
		45134,
		44896,
		44659,
		44421,
		44183,
		43945,
		43708,
		43505,
		43267,
		43030,
		42792,
		42554,
		42316,
		42079,
		41841,
		41603,
		41366,
		41128,
		40890,
		40652,
		40415,
		40177,
		39939,
		39701,
		39508,
		39270,
		39032,
		38794,
		38557,
		38319,
		38081,
		37844,
		37606,
		37368,
		37130,
		36893,
		36655,
		36417,
		36179,
		35942,
		35739,
		35501,
		35264,
		35026,
		34788,
		34550,
		34313,
		34075,
		33837,
		33600,
		33362,
		33124,
		32886,
		32649,
		32411,
		32173,
		31935,
		31742,
		31504,
		31266,
		31029,
		30791,
		30553,
		30315,
		30078,
		29840,
		29602,
		29364,
		29127,
		28889,
		28651,
		28413,
		28176,
		27973,
		27735,
		27498,
		27260,
		27022,
		26785,
		26547,
		26309,
		26071,
		26115,
		26353,
		26591,
		26829,
		27066,
		27304,
		27542,
		27780,
		27973,
		28211,
		28449,
		28686,
		28924,
		29162,
		29400,
		29637,
		29875,
		30113,
		30351,
		30588,
		30826,
		31064,
		31301,
		31539,
		31777,
		31979,
		32217,
		32455,
		32693,
		32930,
		33168,
		33406,
		33644,
		33881,
		34119,
		34357,
		34595,
		34832,
		35070,
		35308,
		35545,
		35739,
		35977,
		36215,
		36452,
		36690,
		36928,
		37166,
		37403,
		37641,
		37879,
		38116,
		38354,
		38592,
		38830,
		39067,
		39305,
		39543,
		39745,
		39983,
		40221,
		40459,
		40696,
		40934,
		41172,
		41410,
		41647,
		41885,
		42123,
		42360,
		42598,
		42836,
		43074,
		43311,
		43505,
		43743,
		43981,
		44218,
		44456,
		44694,
		44931,
		45169,
		45407,
		45645,
		45882,
		46120,
		46358,
		46596,
		46833,
		47071,
		47309,
		47511,
		47749,
		47987,
		48225,
		48462,
		48700,
		48938,
		49175,
		49413,
		49651,
		49889,
		50126,
		50364,
		50602,
		50840,
		51077,
		51271,
		51509,
		51746,
		51984,
		52222,
		52460,
		52697,
		52935,
		53173,
		53411,
		53648,
		53886,
		54124,
		54362,
		54599,
		54837,
		55075,
		55277,
		55515,
		55753,
		55990,
		56228,
		56466,
		56704,
		56941,
		56783,
		56263,
		55709,
		55198,
		54679,
		54124,
		53613,
		53094,
		52539,
		52028,
		51509,
		50954,
		50443,
		49889,
		49369,
		48814,
		48304,
		47784,
		47230,
		46719,
		46199,
		45645,
		45134,
		44615,
		44060,
		43505,
		42994,
		42475,
		41920,
		41410,
		40890,
		40335,
		39825,
		39305,
		38750,
		38240,
		37720,
		37166,
		36611,
		36100,
		35581,
		35026,
		34515,
		33996,
		33441,
		32930,
		32411,
		31856,
		31346,
		30791,
		30271,
		29717,
		29206,
		28686,
		28132,
		27621,
		27102,
		26547,
		26036,
		25517,
		24962,
		24451,
		23897,
		23377,
		22822,
		22312,
		21792,
		21237,
		20727,
		20207,
		19653,
		19142,
		18622,
		18068,
		17513,
		17002,
		16483,
		15928,
		15417,
		14898,
		14343,
		13833,
		13313,
		12758,
		12248,
		11728,
		11173,
		10619,
		10108,
		9589,
		9034,
		8523,
		8004,
		7449,
		6938,
		6419,
		5864,
		5353,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0

};

void Time0_A_Init();
void TA0_OnTime();
void main(void) {
	WDTCTL=WDTPW+WDTHOLD;
	BCSCTL1 = CALBC1_12MHZ;      /* Set DCO to12MHz */
    DCOCTL = CALDCO_12MHZ;
    DAC8411_Init();
    Time0_A_Init();
    while(1)
    {
     _bis_SR_register(LPM0_bits) ;
    }
}
/******************************************************************************************************
 * 名       称：Time0_A_Init()
 * 功       能：初始化TA0
 * 入口参数：无
 * 出口参数：无
 * 说       明：就是初始化相关IO的状态
 * 范       例：无
 ******************************************************************************************************/
void Time0_A_Init()
{
  TA0CCTL0 = CCIE;                         	// 允许比较/捕获模块0的中断
  TA0CCR0 = SYSCLK/AWG_FREQ/SAMPLENUM;		//设定TA定时周期
  TA0CTL = TASSEL_2 + MC_1;           //TA0设为增计数模式，时钟=SMCLK
  _enable_interrupts();                       //开全局总中断，
}
/******************************************************************************************************
 * 名       称：Timer0_A0
 * 功       能：TACCR0中断服务函数
 * 入口参数：无
 * 出口参数：无
 * 说       明：此中断源独占中断向量入口，无需判断
 * 范       例：无
 ******************************************************************************************************/
#pragma vector=TIMER0_A0_VECTOR
__interrupt void Timer0_A0 (void)
{
	TA0CCTL0 &= ~CCIE;                       // 关闭比较/捕获模块0的中断
	TA0_OnTime();
	TA0CCTL0 = CCIE;                         // 允许比较/捕获模块0的中断
}
/******************************************************************************************************
 * 名       称： TA0_OnTime()
 * 功       能：TA0的定时事件处理函数
 * 入口参数：无
 * 出口参数：无
 * 说       明：无
 * 范       例：无
 ******************************************************************************************************/
void TA0_OnTime()
{
	static unsigned int i=0;
	write2DAC8411(Data[i]);
	i++;
	if(i>SAMPLENUM) i=0;
}
