---
typora-root-url: pictsea
---

# 03阿桦的MSP430学习笔记_端口篇_

```python
#@auther AHUA
#@create  23/9/14
#@brief 端口
#@coteam  zqj

```

- 我们知道大部分的端口都存在端口复用的情况,所以我们这次会尽量全面了解一下
- 我们的期末工程主要关注  IO  AD 中断









###### 端口

我们有三个端口,P1 P2  P3



####P1

每个P口有8个口,,可独立配置中断  上拉下拉电阻以及晶振之类的.我们以P1口为示例,来看一看

输入    P1IN       020H               

输出  P1OUT          021H

方向  P1DIR                 022H

中断   P1IFG          023H

中断边沿   P1IES             024H

中断使能  P1IE        025H

端口选择  P1SEL        026H

端口选择2   P1SEL2        027H

电阻使能  P1REN        028H

除开P1IN是只读状态,其他的都是读/写成立

初始状态   P1IN   ---

P1OUT 不变  中断使能   P1 IE  不变

其余全部都是   PUC复位





##### P2 

P2 口同P1 口



##### P3

P3 口不怎么用

著包含

输入输出  方向 端口选择12

还有电阻使能,不支持中断,所以我们不讲,

以后真的用到了再细讲



#### 端口的配置模式



![](端口配置1.jpg)



```c
//P1DIR   端口输入输出方向  
// 0000 0000 
// 置0 输入  置1 输出




//P1REN  上拉/下拉电阻模式
//0000 0000 
//置0  禁用上拉/下拉电阻
//置1  启用用上拉/下拉电阻
//上拉电阻和下拉电阻是电子电路中常用的两种电阻，它们通常用于数字电路中，特别是在微控制器（MCU）或数字逻辑电路中，以实现信号的稳定和电平的控制。
//上拉电阻（Pull-Up Resistor）： 上拉电阻是连接到一个信号线（通常是输入信号线）的电阻，它的目的是将信号线的电平拉高到逻辑高电平（通常是电源电压，如+5V）或使其稳定。上拉电阻通常连接到一个信号线和正电源电压之间，以防止信号线在未连接到其他设备时浮动。这可以防止不确定的电平状态。
//下拉电阻（Pull-Down Resistor）： 下拉电阻是连接到一个信号线的电阻，它的目的是将信号线的电平拉低到逻辑低电平（通常是地或0V）或使其稳定。下拉电阻通常连接到一个信号线和地之间，以防止信号线在未连接到其他设备时浮动。
//这两种电阻在数字输入或输出中非常有用，因为它们有助于确保信号线在没有明确定义输入时保持在已知状态。例如，在微控制器的数字输入引脚上使用上拉电阻可以确保输入引脚在未连接到外部信号源时保持在高电平状态。同样，使用下拉电阻可以确保输入引脚在未连接到外部信号源时保持在低电平状态。
//在某些情况下，还可以使用可编程引脚来配置引脚的上拉或下拉电阻，而无需外部电阻。这提供了更大的灵活性，可以根据需要动态地配置电平。


//P1OUT
// 0000 0000 
//置0   低电平  置1 高电平

```



![](PXREN.png)



###### 端口寄存器配置的位运算符操作示例

MSP430 的 P1OUT 寄存器通常是一个8位寄存器，每一位都对应着 P1 端口的一个引脚。这些位决定了相应引脚的输出状态（高电平或低电平）。在 MSP430 开发中，通常使用位运算来配置 P1OUT 寄存器，主要原因如下：

1. **精确控制：** 位运算允许您精确地设置和清除每个引脚的状态，而不影响其他引脚。这对于需要精确控制多个引脚的应用非常重要。
2. **节省资源：** 在嵌入式系统中，资源（如内存和处理器时间）通常受限。使用位运算可以节省内存和运行时资源，因为您只需操作寄存器的特定位，而不是整个寄存器。这对于微控制器来说尤其重要，因为它们的资源有限。
3. **快速执行：** 位运算通常比其他方法更快，因为它们直接操作寄存器中的位，而不需要额外的逻辑。这对于实时系统和需要高性能的应用非常重要。

下面是一些常见的 MSP430 P1OUT 寄存器位运算操作示例：

- **设置引脚为高电平：**

  ```
  cCopy code
  P1OUT |= BIT2; // 设置端口1的引脚2为高电平

  ```

  上述代码使用 `|` 运算符将 BIT2（表示第2位）设置为1，从而将端口1的引脚2设置为高电平。

- **清除引脚为低电平：**

  ```
  cCopy code
  P1OUT &= ~BIT5; // 清除端口1的引脚5为低电平

  ```

  上述代码使用 `&` 运算符和 `~` 运算符来将 BIT5（表示第5位）清除为0，从而将端口1的引脚5设置为低电平。

- **翻转引脚状态：**

  ```
  cCopy code
  P1OUT ^= BIT3; // 翻转端口1的引脚3状态

  ```

  上述代码使用 `^` 运算符将 BIT3（表示第3位）的状态翻转，从而翻转端口1的引脚3的状态。





1. **按位与（AND）运算符 (&)：** 将两个操作数的对应位进行逻辑与运算，只有在两个位都为1时，结果位才为1。常用于位掩码操作，清除特定位的值。

   ```
   cCopy code
   result = a & b; // 对a和b进行按位与运算

   ```

2. **按位或（OR）运算符 (|)：** 将两个操作数的对应位进行逻辑或运算，只要有一个位为1，结果位就为1。常用于设置特定位的值。

   ```
   cCopy code
   result = a | b; // 对a和b进行按位或运算

   ```

3. **按位异或（XOR）运算符 (^)：** 将两个操作数的对应位进行逻辑异或运算，如果两个位不相同，结果位为1；如果两个位相同，结果位为0。常用于翻转特定位的状态。

   ```
   cCopy code
   result = a ^ b; // 对a和b进行按位异或运算

   ```

4. **按位取反（NOT）运算符 (~)：** 将操作数的每一位取反，即0变为1，1变为0。

   ```
   cCopy code
   result = ~a; // 对a进行按位取反运算

   ```

5. **左移位运算符 (<<)：** 将操作数的所有位向左移动指定数量的位数，右侧用0填充。常用于实现位的倍增操作。

   ```
   cCopy code
   result = a << 2; // 将a的所有位左移2位

   ```

6. **右移位运算符 (>>)：** 将操作数的所有位向右移动指定数量的位数，左侧用0或符号位填充。常用于实现位的除法或移位操作。

   ```
   cCopy code
   result = a >> 1; // 将a的所有位右移1位
   ```









#### 端口的中断配置



中断的说明

处理中断流程

主程序运行  中断请求  中断响应  中断服务程序  中断返回 继续主程序



  中断响应的条件

中断源有中断请求

中断源的中断允许为1 

CPU开中断  EA=1



中断出发方式  高低电平  上升下降



```c
//想要使用中断时,在我们这里先要配置端口为中断口
//一般来说不需要特别想起来配 看看示例代码就知道中断端口的配置其实就是通用的初始化配置


//中断配置.e'g
P1DIR= 0x00;    //输入口  中断是输入信号
P1REN =0x00;//不上拉电阻
P1SEL =0x00;
P1SEL2= 0x00;




//中断处理流程
配置端口和引脚的方向、状态和电阻器，以确保中断触发条件得到满足。

配置中断触发条件，包括边沿触发类型（上升沿、下降沿等）。

清除中断标志位，以确保中断触发前的标志状态不会导致误触发。

启用中断，使相应的引脚或模块具备触发中断的能力。

编写中断服务程序（中断处理函数），用于处理中断事件。一旦中断触发，控制将跳转到中断服务程序执行特定的操作。
```





```c
//P1IE  中断使能    类似51的IE   就是中断允许寄存器
// 0 禁止中断 
// 1 允许中断








//P1 IES      中断出发方式,类似51的IT 
//  0 上升沿触发中断
// 1 下降沿触发中断





//P1IFG     中断标志寄存器    类似
//每个标志位对应一个可能触发中断的源。当某个中断源触发时，相应的标志位会被设置为1。
//每当时序图中出现我们配置的信号边沿的时候被置位   ___------
//就是对应的中断使能,被置位的时候  我们要求有一个中断 每个IFG必须又软件复位
//  0  没有中断等待
// 1  有中断等待

```



```c
// 中断示例


P1DIR = 0x01 ;//P1.0 引脚配置为输出。这表示 P1.0 不会作为输入触发中断，而是用作输出引脚。
P1OUT  = 0x10;//P1.4 引脚设置为高电平
P1ren = 0x10;//启用了内部上拉电阻（Pull-Up Resistor），这表示在没有外部连接的情况下，P1.4 引脚会被上拉到高电平
P1IES = 0x10;//下降沿触发中断
P1IFG &= ~0x10;//清除 Port 1 中断标志寄存器（Interrupt Flag Register）中 P1.4 引脚的中断标志位。这样做是为了确保在配置中断之前清除任何不必要的中断触发。
//再检查一下是不是没有问题了
P1IE |= 0x10;////使能 Port 1 中断。具体来说，它启用了 P1.4 引脚的中断功能，这意味着当 P1.4 引脚状态发生下降沿变化时，将触发中断。
//打开了开关,拉了闸门



//对应中断处理函数中还要配置IFG

//P1IFG &=~0x10;
//中断处理函数


#pragma  vector=PORT1_VECTOR    //指明中断程序入口地址
--interrupt void Port_1(void)
{
  P1OUT ^= 0x01;
  P1IFG &= ~0x01;
  
  
}
```





###### 中断优先级表



![](中断优先级1.jpg)



![](中断优先级2.jpg)





###### 端口复用表 

```c
//使用端口选择  P1SEL        026H

//端口选择2   P1SEL2        027H

//进行配置 ,进行功能的复用 
//查阅引脚功能表可以明白该怎么配置端口
```



![](P1引脚功能表.jpg)

## 附 MSP430时钟模块



![](时钟源.png)













